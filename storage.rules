rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    
    // Allow users to read and write files only within a folder corresponding to their organizationId.
    // This is crucial for features like bank reconciliation uploads.
    // Example path: /reconciliations/ORG_ID_123/my_statement.ofx
    match /{folder}/{orgId}/{allPaths=**} {
      allow read, write: if request.auth != null && orgId == request.auth.token.organizationId;
    }

    // For any other path not matching the structure above, deny all access by default.
    // This is an implicit denial, but can be made explicit if needed.
    // match /{allOtherPaths=**} {
    //   allow read, write: if false;
    // }
  }
}
